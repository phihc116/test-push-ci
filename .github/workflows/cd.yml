name: Deployment

on:
  workflow_dispatch:
    inputs:
      environment:
        type: choice
        options: [dev, staging, prod]
      update_level:
        type: choice
        options: [major, minor, patch]
      deploy_service_a:
        type: boolean
        default: true
      deploy_service_b:
        type: boolean
        default: true

jobs:
  service-a:
    if: ${{ github.event.inputs.deploy_service_a == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4      
      - uses: ./.github/actions/deploy
        with:
          service: service_a
          environment: ${{ github.event.inputs.environment }}
          update_level: ${{ github.event.inputs.update_level }}
          docker_username: ${{ secrets.DOCKER_USERNAME }}
          docker_password: ${{ secrets.DOCKER_PASSWORD }}

  service-b:
    if: ${{ github.event.inputs.deploy_service_b == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4          
      - uses: ./.github/actions/deploy
        with:
          service: service_b
          environment: ${{ github.event.inputs.environment }}
          update_level: ${{ github.event.inputs.update_level }}
          docker_username: ${{ secrets.DOCKER_USERNAME }}
          docker_password: ${{ secrets.DOCKER_PASSWORD }}
